<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Regan Koopmans
    </title>
    <link rel="stylesheet" href="styles.css">
    <script src="components/nav/nav.js"></script>
</head>
<style>
    #canvas {
        margin: auto;
        display: block;
    }
</style>
<body>
    <section class="card">
        <h1>Regan Koopmans
        </h1>
        <h1 class="subtitle">Software Engineer
        </h1>
        <site-nav></site-nav>
        <p>
            Hi there! I am Regan. I am a software engineer based in The Netherlands.
            I am interested in optimisation, low-level programming and music.
        </p>
        <canvas style="margin-top:10px;" id="canvas" width="300" height="300"></canvas>
        </section>
</body>
<script type> </script>
<script>
    const WIDTH = 62
    function makeArray(w, h, val) {
        let arr = [];
        for(let i = 0; i < h; i++) {
            arr[i] = [];
            for(let j = 0; j < w; j++) { arr[i][j] = val; }
        }
        return arr;
    }

    function count_neighbours(state, i, j) {
        let neighbours = 0;
        if (i > 0 && state[i-1][j]) { neighbours += 1 }
        if (j > 0 && state[i][j-1]) { neighbours += 1 }
        if (i < WIDTH-1 && state[i+1][j]) { neighbours += 1 }
        if (j < WIDTH-1 && state[i][j+1]) { neighbours += 1 }
        if (i > 0 && j > 0 && state[i - 1][j - 1]) { neighbours += 1 }
        if (i < WIDTH-1 && j < WIDTH-1 && state[i + 1][j + 1]) { neighbours += 1}
        if (i > 0 && j < WIDTH-1 && state[i - 1][j + 1]) { neighbours += 1 }
        if (i < WIDTH-1 && j > 0 && state[i + 1][j - 1]) { neighbours += 1 }
        return neighbours
    }

    function next_step(current_state) {
        let new_state = makeArray(WIDTH, WIDTH, undefined);
        let neighbours;
        for (let i = 0; i < WIDTH; i++) {
            for (let j = 0; j < WIDTH; j++) {
                neighbours = count_neighbours(current_state, i, j)
                if (neighbours === 3) {
                    new_state[i][j] = true
                } else if (neighbours === 2 && current_state[i][j]) {
                    new_state[i][j] = true
                }
            }
        }
        return new_state
    }

    let then;

    function render(state) {
        requestAnimationFrame(() => render(state));
        const now = Date.now();
        const elapsed = now - then;
        if (elapsed > fpsInterval) {
            then = now - (elapsed % fpsInterval);

            ctx.rect(0, 0, c.width, c.height);
            ctx.fillStyle = "#1e2124"
            ctx.fill();
            ctx.globalAlpha = 1.0;
            ctx.fillStyle = "white"

            for (let i = 0; i < WIDTH; i++) {
                for (let j = 0; j < WIDTH; j++) {
                    if (grid[i][j]) {
                        ctx.fillText("#", i * 5, j * 5);
                    }
                }
            }
            grid = next_step(grid);
        }
    }

    then = Date.now();
    const fpsInterval = 90
    let inital =
`................O............O................
.........OO........................OO.........
........OOO...OO..............OO...OOO........
..............OO.OO........OO.OO..............
................O............O................
..............................................
..............................................
..............................................
..O........................................O..
.OO........................................OO.
.OO........................................OO.
..............................................
..............................................
..............................................
..OO......................................OO..
..OO......................................OO..
O...O....................................O...O
...O......................................O...
...O......................................O...
..............................................
..............................................
..............................................
..............................................
..............................................
..............................................
..............................................
..............................................
...O......................................O...
...O......................................O...
O...O....................................O...O
..OO......................................OO..
..OO......................................OO..
..............................................
..............................................
..............................................
.OO........................................OO.
.OO........................................OO.
..O........................................O..
..............................................
..............................................
..............................................
................O............O................
..............OO.OO........OO.OO..............
........OOO...OO..............OO...OOO........
.........OO........................OO.........
................O............O................
`
    let lines = inital.split("\n")
    let grid = makeArray(WIDTH, WIDTH, undefined)
    for (let i = 0; i < lines.length; i++) {
        for (let j = 0; j < lines.length; j++) {
            if (lines[i][j] === 'O') {
                grid[i+8][j+8] = true 
            }
        }
    }
    let c = document.getElementById("canvas");
    let ctx = c.getContext("2d");
    ctx.font = "5px Arial";
    ctx.fillStyle = "white"
    render()
</script>
</html>
