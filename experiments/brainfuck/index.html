<html>

<head>
    <title>Brainfuck</title>
</head>

<body>
    <h1>Brainfuck</h1>

    <p>
        Brainfuck is an esoteric programming language created with the aim of
        requiring the smallest possible compiler. The language has only 8
        instructions, but with this it is fully Turing-complete. It closely
        resembles the theoretical definition of a Turing machine in that it
        has a tape of memory cells, a read/write head, and a set of instructions
        to manipulate the tape.
    </p>


    <p>
        A toy implementation is provided below.
    </p>
    <textarea id="source"></textarea>
    <button onclick="run()">Run</button>
    <pre id="output"></pre>
    <script>
        source = document.getElementById('source')
        output = document.getElementById('output')

        let code = ''
        let tape = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        let pointer = 0
        let stack = []
        let programCounter = 0

        commands = {
            '>': function () {
                pointer++
                if (pointer >= tape.length) { tape.push(0) }
            },
            '<': function () {
                pointer--
                if (pointer < 0) {
                    tape.unshift(0)
                    pointer = 0
                }
            },
            '+': () => { tape[pointer]++ },
            '-': () => { tape[pointer]-- },
            '.': () => { output.textContent += String.fromCharCode(tape[pointer]) },
            ',': () => { tape[pointer] = prompt('Enter a character:').charCodeAt(0) },
            '[': () => {
                if (tape[pointer] === 0) {
                    let depth = 1
                    while (depth > 0) {
                        programCounter++
                        if (code[programCounter] === '[') {
                            depth++
                        } else if (code[programCounter] === ']') { depth-- }
                    }
                } else { stack.push(programCounter) }
            },
            ']': function () { programCounter = stack.pop() - 1 }
        }


        function run() {
            code = source.value
            tape = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            pointer = 0
            stack = []
            programCounter = 0
            output.textContent = ''
            iter_count = 100000
            while (programCounter < code.length && iter_count-- > 0) {
                let instr = code[programCounter]
                if (instr in commands) { commands[instr]() }
                programCounter++
            }
        }
    </script>
</body>

</html>